<?
	header('Content-type: application/json');
	session_start();
	date_default_timezone_set('Etc/GMT-7');
	$out='';
	
	if (isset($_SESSION['username']))
	{
		$usr_name = $_SESSION['username'];
	}
	else if (isset($_SESSION['guestname']))
	{
		$usr_name = $_SESSION['guestname'];
	}
	
	if (isset($_SESSION['username']) || isset($_SESSION['guestname']))//Определение сессии. Есть ли ник
	{
		if(file_exists($_SERVER['DOCUMENT_ROOT'].'/engine/include/chat/online/'.$usr_name.'.txt') == true)
		{
			
		$fp = file($_SERVER['DOCUMENT_ROOT'].'/engine/include/chat/lgchat86123.txt');
		
		$file = json_decode(file_get_contents($_SERVER['DOCUMENT_ROOT'].'/engine/include/chat/on/'.$usr_name.'.arr'));
		$old = $file->str;

		
		if($old < sizeof($fp))
		{
			$a = json_decode(file_get_contents($_SERVER['DOCUMENT_ROOT'].'/engine/include/chat/on/'.$usr_name.'_ignore.arr'));

			foreach ($a as $v)//Если в игноре
			{
				$name_ignore = '<!--<[name_'.$v.']>-->';
				if (strpos($fp[$old], $name_ignore) === false)
				{

				} 
				else 
				{
					$file->str++;
					write_wb($_SERVER['DOCUMENT_ROOT'].'/engine/include/chat/on/'.$usr_name.'.arr', json_encode($file));
					exit;
				}		
			}

			if (isset($_SESSION['username']))
			{
				$real_nick_name = GetInTranslit_fp_tr(file_get_contents($_SERVER['DOCUMENT_ROOT'].'/database/users/'.$_SESSION['username'].'/login_translit.txt'));//Для русских имен.
				$conf=json_decode(file_get_contents($_SERVER['DOCUMENT_ROOT'].'/database/users/'.$_SESSION['username'].'/chat_cfg.arr'));
			}
			else if (isset($_SESSION['guestname']))
			{
				$real_nick_name = GetInTranslit_fp_tr(file_get_contents($_SERVER['DOCUMENT_ROOT'].'/database/guest/'.$_SESSION['guestname'].'.txt'));//Для русских имен.
				$conf=array('0','0','true');
			}
			$fp_tr = GetInTranslit_fp_tr($fp[$old]);//Для русских букв
			$scripts = '';
			
			$name_alert = '<!--<[alert_'.$usr_name.']>-->';
			if (strpos($fp_tr, $name_alert) === false){}
			else
			{
				$scripts = $scripts.'play_message_alarm();$("title").text("Проснись и пой, Проснись и пой! Попробуй в жизни хоть раз - Не выпускать улыбку из открытых глаз!");';
			} 
	
			
			
			$my_name_is = $real_nick_name.',';
						

			if($conf[2]=='false')//Не отображать смайлы
			{
//Smiles_Search_Generator
$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/main/mir1.gif"/> ','<span id="chat_js_view_smile_1" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/main/mir1.gif","chat_js_view_smile_1")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/main/mg252.gif"/> ','<span id="chat_js_view_smile_2" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/main/mg252.gif","chat_js_view_smile_2")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/main/103.gif"/> ','<span id="chat_js_view_smile_3" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/main/103.gif","chat_js_view_smile_3")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/main/0094.gif"/> ','<span id="chat_js_view_smile_4" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/main/0094.gif","chat_js_view_smile_4")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/main/4124king.gif"/> ','<span id="chat_js_view_smile_5" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/main/4124king.gif","chat_js_view_smile_5")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/main/aa.gif"/> ','<span id="chat_js_view_smile_6" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/main/aa.gif","chat_js_view_smile_6")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/main/ab.gif"/> ','<span id="chat_js_view_smile_7" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/main/ab.gif","chat_js_view_smile_7")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/main/ac.gif"/> ','<span id="chat_js_view_smile_8" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/main/ac.gif","chat_js_view_smile_8")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/main/ag.gif"/> ','<span id="chat_js_view_smile_9" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/main/ag.gif","chat_js_view_smile_9")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/main/ah.gif"/> ','<span id="chat_js_view_smile_10" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/main/ah.gif","chat_js_view_smile_10")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/main/ai.gif"/> ','<span id="chat_js_view_smile_11" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/main/ai.gif","chat_js_view_smile_11")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/main/al.gif"/> ','<span id="chat_js_view_smile_12" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/main/al.gif","chat_js_view_smile_12")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/main/an.gif"/> ','<span id="chat_js_view_smile_13" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/main/an.gif","chat_js_view_smile_13")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/main/ap.gif"/> ','<span id="chat_js_view_smile_14" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/main/ap.gif","chat_js_view_smile_14")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/main/aq.gif"/> ','<span id="chat_js_view_smile_15" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/main/aq.gif","chat_js_view_smile_15")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/main/at.gif"/> ','<span id="chat_js_view_smile_16" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/main/at.gif","chat_js_view_smile_16")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/main/au.gif"/> ','<span id="chat_js_view_smile_17" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/main/au.gif","chat_js_view_smile_17")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/main/bye.gif"/> ','<span id="chat_js_view_smile_18" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/main/bye.gif","chat_js_view_smile_18")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/main/c0113.gif"/> ','<span id="chat_js_view_smile_19" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/main/c0113.gif","chat_js_view_smile_19")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/main/crazy.gif"/> ','<span id="chat_js_view_smile_20" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/main/crazy.gif","chat_js_view_smile_20")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/main/dirol.gif"/> ','<span id="chat_js_view_smile_21" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/main/dirol.gif","chat_js_view_smile_21")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/main/good.gif"/> ','<span id="chat_js_view_smile_22" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/main/good.gif","chat_js_view_smile_22")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/main/m0772.gif"/> ','<span id="chat_js_view_smile_23" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/main/m0772.gif","chat_js_view_smile_23")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/main/m1104.gif"/> ','<span id="chat_js_view_smile_24" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/main/m1104.gif","chat_js_view_smile_24")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/main/m1131.gif"/> ','<span id="chat_js_view_smile_25" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/main/m1131.gif","chat_js_view_smile_25")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/main/m1137.gif"/> ','<span id="chat_js_view_smile_26" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/main/m1137.gif","chat_js_view_smile_26")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/main/m1301.gif"/> ','<span id="chat_js_view_smile_27" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/main/m1301.gif","chat_js_view_smile_27")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/main/m1324.gif"/> ','<span id="chat_js_view_smile_28" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/main/m1324.gif","chat_js_view_smile_28")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/main/m2002.gif"/> ','<span id="chat_js_view_smile_29" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/main/m2002.gif","chat_js_view_smile_29")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/main/m2012.gif"/> ','<span id="chat_js_view_smile_30" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/main/m2012.gif","chat_js_view_smile_30")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/main/m2201.gif"/> ','<span id="chat_js_view_smile_31" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/main/m2201.gif","chat_js_view_smile_31")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/main/pri1.gif"/> ','<span id="chat_js_view_smile_32" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/main/pri1.gif","chat_js_view_smile_32")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/main/scr1.gif"/> ','<span id="chat_js_view_smile_33" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/main/scr1.gif","chat_js_view_smile_33")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/main/sig1.gif"/> ','<span id="chat_js_view_smile_34" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/main/sig1.gif","chat_js_view_smile_34")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/main/sle1.gif"/> ','<span id="chat_js_view_smile_35" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/main/sle1.gif","chat_js_view_smile_35")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/main/smile156.gif"/> ','<span id="chat_js_view_smile_36" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/main/smile156.gif","chat_js_view_smile_36")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/main/smile43.gif"/> ','<span id="chat_js_view_smile_37" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/main/smile43.gif","chat_js_view_smile_37")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/main/t141038.gif"/> ','<span id="chat_js_view_smile_38" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/main/t141038.gif","chat_js_view_smile_38")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/main/t142024.gif"/> ','<span id="chat_js_view_smile_39" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/main/t142024.gif","chat_js_view_smile_39")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/main/t142027.gif"/> ','<span id="chat_js_view_smile_40" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/main/t142027.gif","chat_js_view_smile_40")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/main/t2314.gif"/> ','<span id="chat_js_view_smile_41" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/main/t2314.gif","chat_js_view_smile_41")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/main/t2708.gif"/> ','<span id="chat_js_view_smile_42" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/main/t2708.gif","chat_js_view_smile_42")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/main/t4105.gif"/> ','<span id="chat_js_view_smile_43" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/main/t4105.gif","chat_js_view_smile_43")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/main/t9509.gif"/> ','<span id="chat_js_view_smile_44" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/main/t9509.gif","chat_js_view_smile_44")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/main/vav2.gif"/> ','<span id="chat_js_view_smile_45" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/main/vav2.gif","chat_js_view_smile_45")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/main/xdf2.gif"/> ','<span id="chat_js_view_smile_46" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/main/xdf2.gif","chat_js_view_smile_46")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/main/ad2.gif"/> ','<span id="chat_js_view_smile_47" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/main/ad2.gif","chat_js_view_smile_47")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/food/101.gif"/> ','<span id="chat_js_view_smile_48" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/food/101.gif","chat_js_view_smile_48")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/food/m05100.gif"/> ','<span id="chat_js_view_smile_49" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/food/m05100.gif","chat_js_view_smile_49")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/food/m05101.gif"/> ','<span id="chat_js_view_smile_50" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/food/m05101.gif","chat_js_view_smile_50")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/food/t0204.gif"/> ','<span id="chat_js_view_smile_51" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/food/t0204.gif","chat_js_view_smile_51")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/food/t02134.gif"/> ','<span id="chat_js_view_smile_52" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/food/t02134.gif","chat_js_view_smile_52")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/food/t02135.gif"/> ','<span id="chat_js_view_smile_53" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/food/t02135.gif","chat_js_view_smile_53")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/food/t0236.gif"/> ','<span id="chat_js_view_smile_54" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/food/t0236.gif","chat_js_view_smile_54")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/food/t0241.gif"/> ','<span id="chat_js_view_smile_55" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/food/t0241.gif","chat_js_view_smile_55")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/food/t0244.gif"/> ','<span id="chat_js_view_smile_56" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/food/t0244.gif","chat_js_view_smile_56")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/food/t0245.gif"/> ','<span id="chat_js_view_smile_57" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/food/t0245.gif","chat_js_view_smile_57")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/food/t0246.gif"/> ','<span id="chat_js_view_smile_58" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/food/t0246.gif","chat_js_view_smile_58")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/food/t0267.gif"/> ','<span id="chat_js_view_smile_59" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/food/t0267.gif","chat_js_view_smile_59")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/food/t0280.gif"/> ','<span id="chat_js_view_smile_60" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/food/t0280.gif","chat_js_view_smile_60")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/food/t0283.gif"/> ','<span id="chat_js_view_smile_61" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/food/t0283.gif","chat_js_view_smile_61")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/food/t0284.gif"/> ','<span id="chat_js_view_smile_62" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/food/t0284.gif","chat_js_view_smile_62")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/food/t0291.gif"/> ','<span id="chat_js_view_smile_63" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/food/t0291.gif","chat_js_view_smile_63")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/food/t0292.gif"/> ','<span id="chat_js_view_smile_64" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/food/t0292.gif","chat_js_view_smile_64")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/trollface/1.gif"/> ','<span id="chat_js_view_smile_65" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/trollface/1.gif","chat_js_view_smile_65")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/trollface/10.gif"/> ','<span id="chat_js_view_smile_66" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/trollface/10.gif","chat_js_view_smile_66")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/trollface/11.gif"/> ','<span id="chat_js_view_smile_67" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/trollface/11.gif","chat_js_view_smile_67")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/trollface/12.gif"/> ','<span id="chat_js_view_smile_68" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/trollface/12.gif","chat_js_view_smile_68")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/trollface/13.gif"/> ','<span id="chat_js_view_smile_69" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/trollface/13.gif","chat_js_view_smile_69")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/trollface/14.gif"/> ','<span id="chat_js_view_smile_70" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/trollface/14.gif","chat_js_view_smile_70")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/trollface/15.gif"/> ','<span id="chat_js_view_smile_71" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/trollface/15.gif","chat_js_view_smile_71")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/trollface/16_!.gif"/> ','<span id="chat_js_view_smile_72" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/trollface/16_!.gif","chat_js_view_smile_72")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/trollface/17.gif"/> ','<span id="chat_js_view_smile_73" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/trollface/17.gif","chat_js_view_smile_73")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/trollface/18.gif"/> ','<span id="chat_js_view_smile_74" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/trollface/18.gif","chat_js_view_smile_74")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/trollface/19.gif"/> ','<span id="chat_js_view_smile_75" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/trollface/19.gif","chat_js_view_smile_75")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/trollface/2.gif"/> ','<span id="chat_js_view_smile_76" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/trollface/2.gif","chat_js_view_smile_76")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/trollface/20.gif"/> ','<span id="chat_js_view_smile_77" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/trollface/20.gif","chat_js_view_smile_77")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/trollface/21.gif"/> ','<span id="chat_js_view_smile_78" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/trollface/21.gif","chat_js_view_smile_78")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/trollface/22.gif"/> ','<span id="chat_js_view_smile_79" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/trollface/22.gif","chat_js_view_smile_79")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/trollface/23.gif"/> ','<span id="chat_js_view_smile_80" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/trollface/23.gif","chat_js_view_smile_80")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/trollface/24.gif"/> ','<span id="chat_js_view_smile_81" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/trollface/24.gif","chat_js_view_smile_81")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/trollface/25.gif"/> ','<span id="chat_js_view_smile_82" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/trollface/25.gif","chat_js_view_smile_82")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/trollface/26.gif"/> ','<span id="chat_js_view_smile_83" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/trollface/26.gif","chat_js_view_smile_83")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/trollface/27.gif"/> ','<span id="chat_js_view_smile_84" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/trollface/27.gif","chat_js_view_smile_84")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/trollface/28.gif"/> ','<span id="chat_js_view_smile_85" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/trollface/28.gif","chat_js_view_smile_85")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/trollface/29.gif"/> ','<span id="chat_js_view_smile_86" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/trollface/29.gif","chat_js_view_smile_86")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/trollface/3.gif"/> ','<span id="chat_js_view_smile_87" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/trollface/3.gif","chat_js_view_smile_87")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/trollface/30.gif"/> ','<span id="chat_js_view_smile_88" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/trollface/30.gif","chat_js_view_smile_88")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/trollface/31.gif"/> ','<span id="chat_js_view_smile_89" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/trollface/31.gif","chat_js_view_smile_89")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/trollface/32.gif"/> ','<span id="chat_js_view_smile_90" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/trollface/32.gif","chat_js_view_smile_90")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/trollface/33.gif"/> ','<span id="chat_js_view_smile_91" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/trollface/33.gif","chat_js_view_smile_91")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/trollface/34.gif"/> ','<span id="chat_js_view_smile_92" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/trollface/34.gif","chat_js_view_smile_92")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/trollface/35.gif"/> ','<span id="chat_js_view_smile_93" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/trollface/35.gif","chat_js_view_smile_93")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/trollface/36.gif"/> ','<span id="chat_js_view_smile_94" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/trollface/36.gif","chat_js_view_smile_94")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/trollface/37.gif"/> ','<span id="chat_js_view_smile_95" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/trollface/37.gif","chat_js_view_smile_95")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/trollface/38.gif"/> ','<span id="chat_js_view_smile_96" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/trollface/38.gif","chat_js_view_smile_96")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/trollface/4.gif"/> ','<span id="chat_js_view_smile_97" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/trollface/4.gif","chat_js_view_smile_97")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/trollface/6.gif"/> ','<span id="chat_js_view_smile_98" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/trollface/6.gif","chat_js_view_smile_98")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/trollface/7.gif"/> ','<span id="chat_js_view_smile_99" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/trollface/7.gif","chat_js_view_smile_99")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/trollface/8.gif"/> ','<span id="chat_js_view_smile_100" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/trollface/8.gif","chat_js_view_smile_100")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/trollface/9.gif"/> ','<span id="chat_js_view_smile_101" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/trollface/9.gif","chat_js_view_smile_101")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/trollface/fry1.png"/> ','<span id="chat_js_view_smile_102" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/trollface/fry1.png","chat_js_view_smile_102")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/trollface/prf1.gif"/> ','<span id="chat_js_view_smile_103" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/trollface/prf1.gif","chat_js_view_smile_103")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/trollface/t_6278.gif"/> ','<span id="chat_js_view_smile_104" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/trollface/t_6278.gif","chat_js_view_smile_104")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/music/m0803.gif"/> ','<span id="chat_js_view_smile_105" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/music/m0803.gif","chat_js_view_smile_105")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/music/m0804.gif"/> ','<span id="chat_js_view_smile_106" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/music/m0804.gif","chat_js_view_smile_106")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/music/m0807.gif"/> ','<span id="chat_js_view_smile_107" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/music/m0807.gif","chat_js_view_smile_107")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/music/m0822.gif"/> ','<span id="chat_js_view_smile_108" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/music/m0822.gif","chat_js_view_smile_108")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/music/m0823.gif"/> ','<span id="chat_js_view_smile_109" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/music/m0823.gif","chat_js_view_smile_109")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/music/m0826.gif"/> ','<span id="chat_js_view_smile_110" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/music/m0826.gif","chat_js_view_smile_110")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/music/m0828.gif"/> ','<span id="chat_js_view_smile_111" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/music/m0828.gif","chat_js_view_smile_111")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/music/m0830.gif"/> ','<span id="chat_js_view_smile_112" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/music/m0830.gif","chat_js_view_smile_112")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/music/m0831.gif"/> ','<span id="chat_js_view_smile_113" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/music/m0831.gif","chat_js_view_smile_113")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/music/m0833.gif"/> ','<span id="chat_js_view_smile_114" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/music/m0833.gif","chat_js_view_smile_114")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/music/m0837.gif"/> ','<span id="chat_js_view_smile_115" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/music/m0837.gif","chat_js_view_smile_115")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/music/m0838.gif"/> ','<span id="chat_js_view_smile_116" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/music/m0838.gif","chat_js_view_smile_116")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/music/m0854.gif"/> ','<span id="chat_js_view_smile_117" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/music/m0854.gif","chat_js_view_smile_117")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/music/m0855.gif"/> ','<span id="chat_js_view_smile_118" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/music/m0855.gif","chat_js_view_smile_118")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/music/m0862.gif"/> ','<span id="chat_js_view_smile_119" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/music/m0862.gif","chat_js_view_smile_119")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/music/m0871.gif"/> ','<span id="chat_js_view_smile_120" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/music/m0871.gif","chat_js_view_smile_120")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/love/126.gif"/> ','<span id="chat_js_view_smile_121" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/love/126.gif","chat_js_view_smile_121")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/love/aj.gif"/> ','<span id="chat_js_view_smile_122" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/love/aj.gif","chat_js_view_smile_122")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/love/girl_in_love.gif"/> ','<span id="chat_js_view_smile_123" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/love/girl_in_love.gif","chat_js_view_smile_123")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/love/l12424.gif"/> ','<span id="chat_js_view_smile_124" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/love/l12424.gif","chat_js_view_smile_124")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/love/m0611.gif"/> ','<span id="chat_js_view_smile_125" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/love/m0611.gif","chat_js_view_smile_125")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/love/m0630.gif"/> ','<span id="chat_js_view_smile_126" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/love/m0630.gif","chat_js_view_smile_126")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/love/m0631.gif"/> ','<span id="chat_js_view_smile_127" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/love/m0631.gif","chat_js_view_smile_127")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/love/m0634.gif"/> ','<span id="chat_js_view_smile_128" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/love/m0634.gif","chat_js_view_smile_128")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/love/m0646.gif"/> ','<span id="chat_js_view_smile_129" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/love/m0646.gif","chat_js_view_smile_129")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/love/m0652.gif"/> ','<span id="chat_js_view_smile_130" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/love/m0652.gif","chat_js_view_smile_130")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/love/m0654.gif"/> ','<span id="chat_js_view_smile_131" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/love/m0654.gif","chat_js_view_smile_131")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/love/t12423.gif"/> ','<span id="chat_js_view_smile_132" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/love/t12423.gif","chat_js_view_smile_132")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/love/t34224.gif"/> ','<span id="chat_js_view_smile_133" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/love/t34224.gif","chat_js_view_smile_133")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/love/t4404.gif"/> ','<span id="chat_js_view_smile_134" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/love/t4404.gif","chat_js_view_smile_134")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/love/t4810.gif"/> ','<span id="chat_js_view_smile_135" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/love/t4810.gif","chat_js_view_smile_135")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/love/t4812.gif"/> ','<span id="chat_js_view_smile_136" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/love/t4812.gif","chat_js_view_smile_136")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/love/t4868.gif"/> ','<span id="chat_js_view_smile_137" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/love/t4868.gif","chat_js_view_smile_137")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/holiday/B_B1.gif"/> ','<span id="chat_js_view_smile_138" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/holiday/B_B1.gif","chat_js_view_smile_138")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/holiday/h41234.gif"/> ','<span id="chat_js_view_smile_139" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/holiday/h41234.gif","chat_js_view_smile_139")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/holiday/m1004.gif"/> ','<span id="chat_js_view_smile_140" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/holiday/m1004.gif","chat_js_view_smile_140")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/holiday/m1029.gif"/> ','<span id="chat_js_view_smile_141" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/holiday/m1029.gif","chat_js_view_smile_141")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/holiday/smile20.gif"/> ','<span id="chat_js_view_smile_142" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/holiday/smile20.gif","chat_js_view_smile_142")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/job/j1.gif"/> ','<span id="chat_js_view_smile_143" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/job/j1.gif","chat_js_view_smile_143")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/job/j5.gif"/> ','<span id="chat_js_view_smile_144" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/job/j5.gif","chat_js_view_smile_144")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/job/j2.gif"/> ','<span id="chat_js_view_smile_145" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/job/j2.gif","chat_js_view_smile_145")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/job/j3.gif"/> ','<span id="chat_js_view_smile_146" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/job/j3.gif","chat_js_view_smile_146")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/job/j4.gif"/> ','<span id="chat_js_view_smile_147" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/job/j4.gif","chat_js_view_smile_147")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/job/j6.gif"/> ','<span id="chat_js_view_smile_148" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/job/j6.gif","chat_js_view_smile_148")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/computer/compg2.gif"/> ','<span id="chat_js_view_smile_149" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/computer/compg2.gif","chat_js_view_smile_149")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/computer/m1902.gif"/> ','<span id="chat_js_view_smile_150" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/computer/m1902.gif","chat_js_view_smile_150")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/computer/m1904.gif"/> ','<span id="chat_js_view_smile_151" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/computer/m1904.gif","chat_js_view_smile_151")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/computer/m1905.gif"/> ','<span id="chat_js_view_smile_152" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/computer/m1905.gif","chat_js_view_smile_152")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/computer/m1908.gif"/> ','<span id="chat_js_view_smile_153" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/computer/m1908.gif","chat_js_view_smile_153")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/computer/m19110.gif"/> ','<span id="chat_js_view_smile_154" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/computer/m19110.gif","chat_js_view_smile_154")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/computer/m19127.gif"/> ','<span id="chat_js_view_smile_155" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/computer/m19127.gif","chat_js_view_smile_155")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/friends/84.gif"/> ','<span id="chat_js_view_smile_156" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/friends/84.gif","chat_js_view_smile_156")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/friends/c0407.gif"/> ','<span id="chat_js_view_smile_157" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/friends/c0407.gif","chat_js_view_smile_157")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/friends/c0417.gif"/> ','<span id="chat_js_view_smile_158" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/friends/c0417.gif","chat_js_view_smile_158")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/friends/smile107.gif"/> ','<span id="chat_js_view_smile_159" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/friends/smile107.gif","chat_js_view_smile_159")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/weapon/21fe.gif"/> ','<span id="chat_js_view_smile_160" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/weapon/21fe.gif","chat_js_view_smile_160")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/weapon/gun252.gif"/> ','<span id="chat_js_view_smile_161" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/weapon/gun252.gif","chat_js_view_smile_161")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/weapon/W_W4.gif"/> ','<span id="chat_js_view_smile_162" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/weapon/W_W4.gif","chat_js_view_smile_162")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/weapon/ter1.gif"/> ','<span id="chat_js_view_smile_163" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/weapon/ter1.gif","chat_js_view_smile_163")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/weapon/W_W1.gif"/> ','<span id="chat_js_view_smile_164" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/weapon/W_W1.gif","chat_js_view_smile_164")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/weapon/W_W2.gif"/> ','<span id="chat_js_view_smile_165" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/weapon/W_W2.gif","chat_js_view_smile_165")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/weapon/W_W3.gif"/> ','<span id="chat_js_view_smile_166" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/weapon/W_W3.gif","chat_js_view_smile_166")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/sport/m0760.gif"/> ','<span id="chat_js_view_smile_167" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/sport/m0760.gif","chat_js_view_smile_167")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/sport/smile52.gif"/> ','<span id="chat_js_view_smile_168" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/sport/smile52.gif","chat_js_view_smile_168")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/sport/training1.gif"/> ','<span id="chat_js_view_smile_169" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/sport/training1.gif","chat_js_view_smile_169")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/dance/h0708.gif"/> ','<span id="chat_js_view_smile_170" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/dance/h0708.gif","chat_js_view_smile_170")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/dance/h0721.gif"/> ','<span id="chat_js_view_smile_171" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/dance/h0721.gif","chat_js_view_smile_171")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/dance/h0731.gif"/> ','<span id="chat_js_view_smile_172" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/dance/h0731.gif","chat_js_view_smile_172")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/dance/x1612064411.gif"/> ','<span id="chat_js_view_smile_173" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/dance/x1612064411.gif","chat_js_view_smile_173")>[+]</span>',$fp[$old]);$fp[$old]=str_replace(' <img alt="" class="chat_sc" src="/engine/images/smile/dance/x1701214012.gif"/> ','<span id="chat_js_view_smile_174" class="cursor_pointer" onclick=chat_view_smile("/engine/images/smile/dance/x1701214012.gif","chat_js_view_smile_174")>[+]</span>',$fp[$old]);
			}		

									
			if (preg_match("/".$my_name_is."/", $fp_tr))
			{
				if (preg_match("/".preg_quote("[@private]".$my_name_is)."/", $fp_tr))
				{
					$fp[$old] = str_replace("[@private]", '',$fp[$old]);//Очистка сообщения от знака [@private]
					$out.= '<div class="chat_all_message_style chat_users_private_messages">'.$fp[$old].'</div>
					<script>
					play_message_private();
					$("title").text("Новое личное сообщение");
					'.$scripts.'
					</script>';
				}
				else
				{
					$out.= '<div class="chat_all_message_style chat_users_only_you">'.$fp[$old].'</div>
					<script>
					play_message();
					$("title").text("Новое сообщение");
					'.$scripts.'
					</script>';
				}
			}
			else
			{
				if(strpos($fp[$old], '<!--<[render_for_'.$usr_name.']>-->') === false)
				{
				
				}
				else
				{
					$fp[$old] = str_replace("[@private]", '',$fp[$old]);//Очистка сообщения от знака [@private]
					$out.= '<div class="chat_all_message_style chat_users_my_private_messages">'.$fp[$old].'</div>
					<script>
					'.$scripts.'
					</script>';
				} 
				
				
				if (preg_match("/".preg_quote("[@private]")."/", $fp_tr))//Проверить обычное сообщение на личное.
				{

				}
				else
				{
					if (preg_match("/".preg_quote('<div class="chat_all_message_style chat_system_message">').'/', $fp_tr))//Проверить сообщение на системное
					{
						$out.= $fp[$old].'<script>
						'.$scripts.'
						</script>';
					}
					else
					{
						$out.= '<div class="chat_all_message_style chat_old_users_message">'.$fp[$old].'</div>
						<script>
						'.$scripts.'
						</script>';
					}
				}
			}
			$file->str++;
			write_wb($_SERVER['DOCUMENT_ROOT'].'/engine/include/chat/on/'.$usr_name.'.arr', json_encode($file));
		}
		else if($old > sizeof($fp))//Если строк у пользователя больше чем в чате. Например "Очистка лога";
		{
			$file->str=sizeof($fp);
			write_wb($_SERVER['DOCUMENT_ROOT'].'/engine/include/chat/on/'.$usr_name.'.arr', json_encode($file));
		}
		else if($old == sizeof($fp))
		{

		}
		
		$file = json_decode(file_get_contents($_SERVER['DOCUMENT_ROOT'].'/engine/include/chat/on/'.$usr_name.'.arr'));
		if($file->print_message != $_GET['s'])
		{
			$file->print_message=$_GET['s'];
			write_wb($_SERVER['DOCUMENT_ROOT'].'/engine/include/chat/on/'.$usr_name.'.arr', json_encode($file));
		}
	}
	else
	{
		$out.= '<script>reboot_mainmenu();</script>';
	}
	
	}
	
	$out_arr=array();
	if(isset($_GET['u']))
	{
		for ($i = 0; $i < count($_GET['u']); $i++)
		{
			if(file_exists($_SERVER['DOCUMENT_ROOT'].'/engine/include/chat/on/'.GetInTranslit_fp_tr($_GET['u'][$i]).'.arr'))
			{
				$file = json_decode(file_get_contents($_SERVER['DOCUMENT_ROOT'].'/engine/include/chat/on/'.GetInTranslit_fp_tr($_GET['u'][$i]).'.arr'));
				$out_arr[]=array($_GET['u'][$i], $file->print_message);
			}
			else
			{
				$out_arr[]=array($_GET['u'][$i], 'offline');
			}
		}
	}
	session_write_close();
	
	

	$Minecraft = file_get_contents('http://minecraft.neeboo.ru/chat/get');
	
	if(isset($Minecraft)) {
		if($Minecraft != ""){ 
			$MinecraftOld = file_get_contents($_SERVER['DOCUMENT_ROOT'].'/engine/include/chat/minecraft.txt');
			if($MinecraftOld != $Minecraft) {
				$arr = json_decode($Minecraft);
				$burn_file = fopen($_SERVER['DOCUMENT_ROOT'].'/engine/include/chat/lgchat86123.txt', 'a+');
				fwrite($burn_file, "\n".'<!--<[name_'.$arr->name.']>-->['.date("H:i:s").'] [Minecraft] <b onclick="print_message(this); return false;" class="cursor_pointer bold" style="color:#000000;">'.$arr->name.'</b>: <span class="chat_usr_message_text bold" style="color:#000000">'.$arr->message.'</span>');//Записываем сообщение
				fclose($burn_file);
				
				write_wb($_SERVER['DOCUMENT_ROOT'].'/engine/include/chat/minecraft.txt', $Minecraft);
				
				include("../MTA/mta_sdk.php");
				$SERVER = new mta("109.227.228.4", 22005);
				$RESOURCE = $SERVER->getResource("chat");
				$RESOURCE->call("BurnChatMSG", $arr->name, $arr->message, "#000000");
			}
		}
	}
	
	
	die(json_encode(
	  array(
		'm' => $out,//Сообщение
		's' => $out_arr//Скрипт
	  )
	));

?>



<?
function write_wb($f, $c){$fw=fopen($f, 'wb');fwrite($fw, $c);fclose($fw);}
function write_ap($f, $c){$fw=fopen($f, 'a+');fwrite($fw, $c);fclose($fw);}
function GetInTranslit_fp_tr($string) {
    $replace = array(
        'а' => 'a',   'б' => 'b',   'в' => 'v',
        'г' => 'g',   'д' => 'd',   'е' => 'e',
        'ё' => 'e',   'ж' => 'zh',  'з' => 'z',
        'и' => 'i',   'й' => 'y',   'к' => 'k',
        'л' => 'l',   'м' => 'm',   'н' => 'n',
        'о' => 'o',   'п' => 'p',   'р' => 'r',
        'с' => 's',   'т' => 't',   'у' => 'u',
        'ф' => 'f',   'х' => 'h',   'ц' => 'c',
        'ч' => 'ch',  'ш' => 'sh',  'щ' => 'sch',
        'ь' => "'",  'ы' => 'y',   'ъ' => "'",
        'э' => 'e',   'ю' => 'yu',  'я' => 'ya',
 
        'А' => 'A',   'Б' => 'B',   'В' => 'V',
        'Г' => 'G',   'Д' => 'D',   'Е' => 'E',
        'Ё' => 'E',   'Ж' => 'Zh',  'З' => 'Z',
        'И' => 'I',   'Й' => 'Y',   'К' => 'K',
        'Л' => 'L',   'М' => 'M',   'Н' => 'N',
        'О' => 'O',   'П' => 'P',   'Р' => 'R',
        'С' => 'S',   'Т' => 'T',   'У' => 'U',
        'Ф' => 'F',   'Х' => 'H',   'Ц' => 'C',
        'Ч' => 'Ch',  'Ш' => 'Sh',  'Щ' => 'Sch',
        'Ь' => "'",  'Ы' => 'Y',   'Ъ' => "'",
        'Э' => 'E',   'Ю' => 'Yu',  'Я' => 'Ya',
    );
	return $str=iconv("UTF-8","UTF-8//IGNORE",strtr($string,$replace));
}
?>
